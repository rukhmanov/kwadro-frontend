<!-- Навигация по категориям -->
<section class="category-nav-section">
  <div class="container">
    <div class="category-nav">
      <a *ngFor="let category of categories" (click)="scrollToCategory(category.id, $event)" class="category-link">
        {{ category.name }}
      </a>
    </div>
  </div>
</section>

<section class="featured-products">
  <div class="container">
    <h2>Популярные товары</h2>
    <div class="products-grid">
      <a *ngFor="let product of featuredProducts" [routerLink]="['/products', product.id]" class="product-card">
        <img
          [src]="(product.images && product.images.length > 0 ? product.images[0] : null) || '/assets/placeholder.svg'"
          [alt]="product.name" (error)="$any($event.target).src='/assets/placeholder.svg'">
        <div class="product-content">
          <h3>{{ product.name }}</h3>
          <p class="price">
            <span *ngIf="product.oldPrice" class="old-price">{{ product.oldPrice }} ₽</span>
            <span class="current-price">{{ product.price }} ₽</span>
          </p>
          <div class="actions" (click)="$event.preventDefault(); $event.stopPropagation();">
            <div *ngIf="!isInCart(product.id)" class="cart-button-wrapper">
              <button (click)="addToCart(product.id, $event)" class="btn-cart" [disabled]="isOutOfStock(product.id)">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 2L7 6m10 0l-2-4M3 6h18l-1 7H4L3 6zM4 13h16l-1 7H5l-1-7z" />
                  <circle cx="9" cy="20" r="1" />
                  <circle cx="20" cy="20" r="1" />
                </svg>
                В корзину
              </button>
            </div>
            <div *ngIf="isInCart(product.id)" class="quantity-controls-card">
              <button (click)="decreaseQuantity(getCartItem(product.id).id, product.id, $event)">−</button>
              <span>{{ getCartItem(product.id).quantity }}</span>
              <button (click)="increaseQuantity(getCartItem(product.id).id, product.id, $event)"
                [disabled]="!canIncreaseQuantity(product.id)">+</button>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
</section>

<section class="catalog-preview">
  <div class="container">
    <!-- Товары по категориям -->
    <div *ngFor="let category of categories" [id]="'category-' + category.id" class="category-section">
      <div class="category-header">
        <a (click)="goToCatalog(category.id, $event)" class="category-title-link">
          <h3>{{ category.name }}</h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7" />
          </svg>
        </a>
      </div>
      <div class="category-products-grid">
        <a *ngFor="let product of getCategoryProducts(category.id)" [routerLink]="['/products', product.id]"
          class="product-card">
          <img
            [src]="(product.images && product.images.length > 0 ? product.images[0] : null) || '/assets/placeholder.svg'"
            [alt]="product.name" (error)="$any($event.target).src='/assets/placeholder.svg'">
          <div class="product-content">
            <h3>{{ product.name }}</h3>
            <p class="price">
              <span *ngIf="product.oldPrice" class="old-price">{{ product.oldPrice }} ₽</span>
              <span class="current-price">{{ product.price }} ₽</span>
            </p>
            <div class="actions" (click)="$event.preventDefault(); $event.stopPropagation();">
              <div *ngIf="!isInCart(product.id)" class="cart-button-wrapper">
                <button (click)="addToCartFromCategory(product, $event)" class="btn-cart"
                  [disabled]="isOutOfStockForProduct(product)">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 2L7 6m10 0l-2-4M3 6h18l-1 7H4L3 6zM4 13h16l-1 7H5l-1-7z" />
                    <circle cx="9" cy="20" r="1" />
                    <circle cx="20" cy="20" r="1" />
                  </svg>
                  В корзину
                </button>
              </div>
              <div *ngIf="isInCart(product.id)" class="quantity-controls-card">
                <button (click)="decreaseQuantityFromCategory(product, $event)">−</button>
                <span>{{ getCartItem(product.id).quantity }}</span>
                <button (click)="increaseQuantityFromCategory(product, $event)"
                  [disabled]="!canIncreaseQuantityForProduct(product)">+</button>
              </div>
            </div>
          </div>
        </a>
      </div>
    </div>
  </div>
</section>

<section class="latest-news">
  <div class="container">
    <h2>Последние новости</h2>
    <div class="news-grid">
      <div *ngFor="let news of latestNews" class="news-card">
        <img *ngIf="news.image" [src]="news.image" [alt]="news.title">
        <div *ngIf="!news.image" class="news-placeholder">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="3" y1="9" x2="21" y2="9"></line>
            <line x1="9" y1="21" x2="9" y2="9"></line>
          </svg>
        </div>
        <h3>{{ news.title }}</h3>
        <p>{{ news.content | slice:0:150 }}...</p>
        <a [routerLink]="['/news', news.id]">Читать далее</a>
      </div>
    </div>
  </div>
</section>