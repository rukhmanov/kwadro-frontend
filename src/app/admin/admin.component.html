<div class="admin-page">
  <div class="container">
    <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
    
    <div class="tabs">
      <button (click)="setTab('products')" [class.active]="activeTab === 'products'">–¢–æ–≤–∞—Ä—ã</button>
      <button (click)="setTab('news')" [class.active]="activeTab === 'news'">–ù–æ–≤–æ—Å—Ç–∏</button>
      <button (click)="setTab('categories')" [class.active]="activeTab === 'categories'">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
      <button (click)="setTab('chats')" [class.active]="activeTab === 'chats'">
        –ß–∞—Ç—ã
        <span *ngIf="unreadChatsCount > 0" class="badge">
          {{ unreadChatsCount }}
        </span>
      </button>
    </div>

    <!-- Products Tab -->
    <div *ngIf="activeTab === 'products'" class="tab-content">
      <h2>{{ editingProduct ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä' : '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä' }}</h2>
      <form (ngSubmit)="saveProduct()">
        <input [(ngModel)]="productForm.name" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
        <textarea [(ngModel)]="productForm.description" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
        <input type="number" [(ngModel)]="productForm.price" name="price" placeholder="–¶–µ–Ω–∞" required>
        <input type="number" [(ngModel)]="productForm.oldPrice" name="oldPrice" placeholder="–°—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞">
        <input [(ngModel)]="productForm.image" name="image" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <input [(ngModel)]="productForm.engine" name="engine" placeholder="–î–≤–∏–≥–∞—Ç–µ–ª—å">
        <input [(ngModel)]="productForm.power" name="power" placeholder="–ú–æ—â–Ω–æ—Å—Ç—å">
        <input type="number" [(ngModel)]="productForm.stock" name="stock" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="0">
        <select [(ngModel)]="productForm.categoryId" name="categoryId" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
        </select>
        <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" (click)="resetForms()" *ngIf="editingProduct">–û—Ç–º–µ–Ω–∞</button>
      </form>

      <h2>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
      <div class="list">
        <div *ngFor="let product of products" class="list-item">
          <span>{{ product.name }}</span>
          <div>
            <button (click)="editProduct(product)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button (click)="deleteProduct(product.id)" class="delete">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <!-- News Tab -->
    <div *ngIf="activeTab === 'news'" class="tab-content">
      <h2>{{ editingNews ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å' }}</h2>
      <form (ngSubmit)="saveNews()">
        <input [(ngModel)]="newsForm.title" name="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required>
        <textarea [(ngModel)]="newsForm.content" name="content" placeholder="–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ" rows="10" required></textarea>
        <input [(ngModel)]="newsForm.image" name="image" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" (click)="resetForms()" *ngIf="editingNews">–û—Ç–º–µ–Ω–∞</button>
      </form>

      <h2>–°–ø–∏—Å–æ–∫ –Ω–æ–≤–æ—Å—Ç–µ–π</h2>
      <div class="list">
        <div *ngFor="let item of news" class="list-item">
          <span>{{ item.title }}</span>
          <div>
            <button (click)="editNews(item)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button (click)="deleteNews(item.id)" class="delete">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Categories Tab -->
    <div *ngIf="activeTab === 'categories'" class="tab-content">
      <h2>{{ editingCategory ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é' : '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é' }}</h2>
      <form (ngSubmit)="saveCategory()">
        <input [(ngModel)]="categoryForm.name" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
        <textarea [(ngModel)]="categoryForm.description" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
        <input [(ngModel)]="categoryForm.image" name="image" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
        <button type="submit" class="btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" (click)="resetForms()" *ngIf="editingCategory">–û—Ç–º–µ–Ω–∞</button>
      </form>

      <h2>–°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h2>
      <div class="list">
        <div *ngFor="let category of categories" class="list-item">
          <span>{{ category.name }}</span>
          <div>
            <button (click)="editCategory(category)">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button (click)="deleteCategory(category.id)" class="delete">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Chats Tab -->
    <div *ngIf="activeTab === 'chats'" class="tab-content chats-tab">
      <div class="chats-layout">
        <div class="chats-list">
          <h2>–ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã</h2>
          <div *ngIf="chatSessions.length === 0" class="no-chats">
            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
          </div>
          <div 
            *ngFor="let session of chatSessions; let i = index" 
            class="chat-session-item"
            [class.active]="selectedChatSession?.id === session.id"
            [class.unread]="session.hasUnreadMessages"
            (click)="selectChatSession(session)">
            <div class="session-header">
              <strong>–ß–∞—Ç #{{ chatSessions.length - i }}</strong>
              <span *ngIf="session.hasUnreadMessages" class="unread-badge">–ù–æ–≤–æ–µ</span>
            </div>
            <div class="session-info">
              <span *ngIf="session.phone">üìû {{ session.phone }}</span>
              <span class="session-date">{{ session.updatedAt | date:'dd.MM.yyyy, HH:mm' }}</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Fullscreen Chat View -->
      <div class="chat-fullscreen-overlay" *ngIf="selectedChatSession" (click)="closeChatSession()">
        <div class="chat-fullscreen" (click)="$event.stopPropagation()">
          <div class="chat-header">
            <div class="chat-header-content">
              <h3>{{ getChatTitle(selectedChatSession) }}</h3>
              <span *ngIf="selectedChatSession.phone">üìû {{ selectedChatSession.phone }}</span>
            </div>
            <button class="close-chat-btn" (click)="closeChatSession()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
          </div>
          <div class="chat-messages-view" #chatMessagesView>
            <div *ngFor="let msg of chatMessages" class="message" [class.admin]="msg.isAdmin">
              <strong>{{ msg.username }}:</strong> {{ msg.message }}
              <span class="message-time">{{ msg.createdAt | date:'dd.MM.yyyy, HH:mm' }}</span>
            </div>
          </div>
          <div class="chat-input-admin">
            <input [(ngModel)]="adminMessage" (keyup.enter)="sendAdminMessage()" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç...">
            <button (click)="sendAdminMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
