<div class="products-page">
  <div class="container">
    <h1>Каталог товаров</h1>

    <div class="tabs">
      <button (click)="filterByCategory(null)" [class.active]="selectedCategory === null" class="tab-btn">
        Все товары
      </button>
      <button *ngFor="let category of categories" (click)="filterByCategory(category.id)"
        [class.active]="selectedCategory === category.id" class="tab-btn">
        {{ category.name }}
      </button>
    </div>

    <div *ngIf="loading" class="loading-message">
      <p>Загрузка товаров...</p>
    </div>

    <div *ngIf="error" class="error-message">
      <p>{{ error }}</p>
    </div>

    <div *ngIf="!loading && !error && products.length === 0" class="empty-message">
      <p>Товары не найдены</p>
    </div>

    <div *ngIf="!loading && !error && products.length > 0" class="products-grid">
      <a *ngFor="let product of products" [routerLink]="['/products', product.id]" class="product-card">
        <div class="product-image-wrapper">
          <img
            [src]="(product.images && product.images.length > 0 ? product.images[0] : null) || '/assets/placeholder.jpg'"
            [alt]="product.name">
          <div *ngIf="product.oldPrice" class="discount-badge">
            -{{ Math.round((1 - product.price / product.oldPrice) * 100) }}%
          </div>
        </div>
        <div class="product-content">
          <h3>{{ product.name }}</h3>
          <p *ngIf="product.description" class="description">{{ product.description | slice:0:100 }}...</p>
          <div class="product-info" *ngIf="product.specifications && product.specifications.length > 0">
            <span *ngFor="let spec of product.specifications" class="info-badge">
              {{ spec.name }}: {{ spec.value }}
            </span>
          </div>
          <div class="price-section">
            <p class="price">
              <span *ngIf="product.oldPrice" class="old-price">{{ product.oldPrice | number }} ₽</span>
              <span class="current-price">{{ product.price | number }} ₽</span>
            </p>
          </div>
          <div class="actions" (click)="$event.preventDefault(); $event.stopPropagation();">
            <div *ngIf="!isInCart(product.id)" class="cart-button-wrapper">
              <button (click)="addToCart(product.id)" class="btn-cart">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 2L7 6m10 0l-2-4M3 6h18l-1 7H4L3 6zM4 13h16l-1 7H5l-1-7z" />
                  <circle cx="9" cy="20" r="1" />
                  <circle cx="20" cy="20" r="1" />
                </svg>
                В корзину
              </button>
            </div>
            <div *ngIf="isInCart(product.id)" class="quantity-controls-card">
              <button (click)="decreaseQuantity(getCartItem(product.id).id, product.id)">−</button>
              <span>{{ getCartItem(product.id).quantity }}</span>
              <button (click)="increaseQuantity(getCartItem(product.id).id, product.id)">+</button>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
</div>